{% load static tailwind_tags %}
<!DOCTYPE html>
<html lang="en" class="scroll-smooth">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>{% block title %}E-Waste Facility Locator{% endblock %}</title>
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&family=Space+Grotesk:wght@500;600;700&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.2/css/all.min.css"  />
    <script>
        (function () {
            try {
                const storageKey = 'ewaste-theme';
                const stored = localStorage.getItem(storageKey);
                const supportsDark = window.matchMedia('(prefers-color-scheme: dark)').matches;
                if (stored === 'dark' || (!stored && supportsDark)) {
                    document.documentElement.classList.add('dark');
                }
            } catch (error) {
                console.warn('Theme preference unavailable', error);
            }
        })();
    </script>
    {% tailwind_css %}
</head>
<body class="bg-slate-50 font-sans text-slate-900 transition-colors duration-300 dark:bg-slate-950 dark:text-slate-100">
    <header class="sticky top-0 z-50 border-b border-slate-200 bg-white/80 backdrop-blur transition-colors duration-300 dark:border-slate-800 dark:bg-slate-900/70">
        <div class="mx-auto flex max-w-6xl items-center justify-between px-6 py-4">
            <a href="{% url 'facilities:home' %}" class="flex items-center gap-2 text-sky-600 transition hover:text-sky-500 dark:text-sky-300 dark:hover:text-sky-200">
                <span class="text-2xl"><i class="fa-solid fa-recycle"></i></span>
                <span class="font-display text-xl font-semibold tracking-wide">E-Waste Navigator</span>
            </a>
            <nav class="flex items-center gap-2 text-sm font-medium">
                <a href="{% url 'facilities:facility_list' %}" class="inline-flex items-center gap-2 rounded-full px-3 py-2 text-slate-600 transition hover:bg-slate-100 hover:text-sky-600 dark:text-slate-200 dark:hover:bg-slate-800/60 dark:hover:text-sky-200">
                    <i class="fa-solid fa-location-dot text-sm"></i>
                    <span>Find Facilities</span>
                </a>
                <a href="{% url 'devices:catalog' %}" class="inline-flex items-center gap-2 rounded-full px-3 py-2 text-slate-600 transition hover:bg-slate-100 hover:text-sky-600 dark:text-slate-200 dark:hover:bg-slate-800/60 dark:hover:text-sky-200">
                    <i class="fa-solid fa-tablet-screen-button text-sm"></i>
                    <span>Device Library</span>
                </a>
                <a href="{% url 'devices:submit' %}" class="inline-flex items-center gap-2 rounded-full px-3 py-2 text-slate-600 transition hover:bg-slate-100 hover:text-sky-600 dark:text-slate-200 dark:hover:bg-slate-800/60 dark:hover:text-sky-200">
                    <i class="fa-solid fa-plus text-sm"></i>
                    <span>Submit Device</span>
                </a>
                {% if request.user.is_authenticated %}
                    {% if request.user.is_staff %}
                        <a href="{% url 'accounts:admin_dashboard' %}" class="inline-flex items-center gap-2 rounded-full px-3 py-2 text-slate-600 transition hover:bg-slate-100 hover:text-sky-600 dark:text-slate-200 dark:hover:bg-slate-800/60 dark:hover:text-sky-200">
                    {% else %}
                        <a href="{% url 'accounts:user_dashboard' %}" class="inline-flex items-center gap-2 rounded-full px-3 py-2 text-slate-600 transition hover:bg-slate-100 hover:text-sky-600 dark:text-slate-200 dark:hover:bg-slate-800/60 dark:hover:text-sky-200">
                    {% endif %}
                        <i class="fa-solid fa-circle-user text-sm"></i>
                        <span>{% if request.user.is_staff %}Admin{% else %}Dashboard{% endif %}</span>
                        </a>
                    <form method="post" action="{% url 'accounts:logout' %}" class="inline-flex">
                        {% csrf_token %}
                        <button type="submit" class="inline-flex items-center gap-2 rounded-full px-3 py-2 text-slate-500 transition hover:bg-rose-50 hover:text-rose-500 dark:text-slate-300 dark:hover:bg-rose-500/10 dark:hover:text-rose-200">
                            <i class="fa-solid fa-arrow-right-from-bracket text-sm"></i>
                            <span>Sign out</span>
                        </button>
                    </form>
                {% else %}
                    <a href="{% url 'accounts:login' %}" class="inline-flex items-center gap-2 rounded-full px-3 py-2 text-slate-600 transition hover:bg-slate-100 hover:text-sky-600 dark:text-slate-200 dark:hover:bg-slate-800/60 dark:hover:text-sky-200">
                        <i class="fa-solid fa-arrow-right-to-bracket text-sm"></i>
                        <span>Sign in</span>
                    </a>
                    <a href="{% url 'accounts:register' %}" class="inline-flex items-center gap-2 rounded-full border border-sky-200 px-3 py-2 text-sky-600 transition hover:bg-sky-50 hover:text-sky-500 dark:border-sky-500/60 dark:text-sky-300 dark:hover:bg-sky-500/10 dark:hover:text-sky-200">
                        <i class="fa-solid fa-user-plus text-sm"></i>
                        <span>Join</span>
                    </a>
                {% endif %}
                <button type="button" data-theme-toggle aria-pressed="false" class="rounded-full border border-slate-200 text-slate-600 transition hover:border-sky-400 hover:bg-slate-100 hover:text-sky-600 dark:border-slate-700 dark:text-slate-200 dark:hover:border-sky-400 dark:hover:bg-slate-800/60 dark:hover:text-sky-200">
                    <span class="sr-only">Toggle theme</span>
                    <i class="theme-icon-sun fa-solid fa-sun text-sm"></i>
                    <i class="theme-icon-moon fa-solid fa-moon hidden text-sm"></i>
                 
                </button>
            </nav>
        </div>
    </header>

    {% if messages %}
        <div class="mx-auto max-w-4xl px-6 pt-6">
            <div class="space-y-3">
                {% for message in messages %}
                    <div class="rounded-lg border border-sky-400/40 bg-sky-100 px-4 py-3 text-sm text-sky-900 dark:bg-sky-500/10 dark:text-sky-100">
                        {{ message }}
                    </div>
                {% endfor %}
            </div>
        </div>
    {% endif %}

    <main class="min-h-screen">
        {% block content %}{% endblock %}
    </main>

    <footer class="border-t border-slate-200 bg-white/90 transition-colors duration-300 dark:border-slate-900 dark:bg-slate-950/80">
        <div class="mx-auto flex max-w-6xl flex-col gap-2 px-6 py-10 text-sm text-slate-500 transition-colors duration-300 md:flex-row md:items-center md:justify-between dark:text-slate-400">
            <p class="flex items-center gap-2">
                <i class="fa-solid fa-shield-heart text-sm"></i>
                <span>&copy; {% now 'Y' %} E-Waste Navigator. All rights reserved.</span>
            </p>
            <div class="flex gap-4">
                <a href="#" class="inline-flex items-center gap-2 hover:text-slate-700 transition dark:hover:text-slate-200">
                    <i class="fa-solid fa-user-shield text-sm"></i>
                    <span>Privacy</span>
                </a>
                <a href="#" class="inline-flex items-center gap-2 hover:text-slate-700 transition dark:hover:text-slate-200">
                    <i class="fa-solid fa-comments text-sm"></i>
                    <span>Support</span>
                </a>
                <a href="#" class="inline-flex items-center gap-2 hover:text-slate-700 transition dark:hover:text-slate-200">
                    <i class="fa-solid fa-book-open text-sm"></i>
                    <span>Educate</span>
                </a>
            </div>
        </div>
    </footer>
    <script>
        (function () {
            const storageKey = 'ewaste-theme';
            const root = document.documentElement;

            const initializeThemeToggle = () => {
                const toggle = document.querySelector('[data-theme-toggle]');
                if (!toggle) {
                    return;
                }

                const sunIcon = toggle.querySelector('.theme-icon-sun');
                const moonIcon = toggle.querySelector('.theme-icon-moon');
                const label = toggle.querySelector('.theme-toggle-label');

                const syncState = () => {
                    const isDark = root.classList.contains('dark');
                    toggle.setAttribute('aria-pressed', String(isDark));
                    
                    if (sunIcon && moonIcon) {
                        sunIcon.classList.toggle('hidden', isDark);
                        moonIcon.classList.toggle('hidden', !isDark);
                    }
                };

                syncState();

                toggle.addEventListener('click', () => {
                    const isDark = root.classList.toggle('dark');
                    try {
                        localStorage.setItem(storageKey, isDark ? 'dark' : 'light');
                    } catch (error) {
                        console.warn('Unable to persist theme preference', error);
                    }
                    syncState();
                });
            };

            if (document.readyState === 'loading') {
                document.addEventListener('DOMContentLoaded', initializeThemeToggle, { once: true });
            } else {
                initializeThemeToggle();
            }
        })();
    </script>
    {% if debug and request.GET.browser_reload == 'on' %}
        <script src="{% url 'django_browser_reload:events' %}" defer></script>
    {% endif %}
</body>
</html>
